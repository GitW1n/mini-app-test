<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="telegram-web-app" content="true" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <title>Mini App</title>
  <link rel="stylesheet" href="style.css">
  <script src="script.jsx"></script>
</head>
<body>
  <header class="header">
    <button onclick="changeContent('settings')">‚öôÔ∏è</button>
    
    <div class="clock" id="clock"></div>
  </header>
  <div class="header" id="adm">–ß—Ç–æ–±—ã –æ—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ—Å—å.</div>
  
  
  <div class="terms-link"> 
    <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å –Ω–∞—à–∏–º <a href="#" onclick="changeContent('terms')">–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ–º</a>.</p>
  </div>  

  <div id="content">
    <div class="user-info">
      <img id="profile-picture" src="images/profile.png" alt="Profile Picture" />
      <span id="username">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
      <span id="user-balance"></span> 
    </div>    
  </div>

  <div class="icon-buttons">
    <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É -->
    <button onclick="goHome()">
      <img src="https://img.icons8.com/?size=100&id=s7mPVCB5sKGa&format=png&color=ffffff" alt="Home" />
    </button>

    <script>
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
      function goHome() {
        changeContent('home');  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
      }
    
      function renderBalance() {
      const content = document.getElementById('content');
      const userInfo = document.querySelector('.user-info').outerHTML;
      content.innerHTML = `
        ${userInfo}
        <h2>–ë–∞–ª–∞–Ω—Å</h2>
        <p>–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: ${balanceInfo.balance} ${balanceInfo.selectedCurrency}</p>
        <label for="currency">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞–ª—é—Ç—É:</label>
        <select id="currency" onchange="changeCurrency(event)">
          ${balanceInfo.currencies.map(currency => `<option value="${currency}" ${currency === balanceInfo.selectedCurrency ? 'selected' : ''}>${currency}</option>`).join('')}
        </select>
      `;
    }

    function changeCurrency(event) {
      balanceInfo.selectedCurrency = event.target.value;
      renderBalance();
    }

    function renderVendors() {
      const content = document.getElementById('content');
      const userInfo = document.querySelector('.user-info').outerHTML;
      content.innerHTML = `
        ${userInfo}
        <h2>–ü—Ä–æ–¥–∞–≤—Ü—ã</h2>
        <div class="product-list" id="product-list"></div>
      `;
      renderProducts(vendors, 'vendors');
    }

      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      function changeContent(page) {
        const content = document.getElementById('content');
        const userInfo = document.querySelector('.user-info').outerHTML;
    
        switch (page) {
          case 'home':
            content.innerHTML = `
              ${userInfo}
              <h2>–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</h2>
              <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É!</p>
              <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª</h3>
              <div class="product-list" id="product-list"></div>
            `;
            renderProducts(mainSections, 'home');
            break;
            
            case 'subscriptions':
      content.innerHTML = `
        ${userInfo}
        <h2>–ü–æ–¥–ø–∏—Å–∫–∏</h2>
        <div class="product-list" id="product-list"></div>
      `;
      renderProducts(subscriptions, 'subscriptions');  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫
      break;
    
          case 'settings':
          content.innerHTML = `
        ${userInfo}
        <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
      `;
      renderProducts(settings, 'settings');
      break;

      case 'balance':
          renderBalance();
          break;

        case 'vendors':
          renderVendors();
          break;
    
          // –î—Ä—É–≥–∏–µ —Å–ª—É—á–∞–∏
          default:
            content.innerHTML = `${userInfo} <h2>–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</h2><p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É!</p>`;
        }
      }
    
      window.addEventListener('load', function () {
        changeContent('home');
      });
    </script>
  
    <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É -->
    <button onclick="changeContent('cart')">
      <img src="https://img.icons8.com/ios/452/shopping-cart.png" alt="Cart" />
    </button>
  
    <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –∑–∞–∫–∞–∑–∞–º -->
    <button onclick="changeContent('orders')">
      <img src="https://img.icons8.com/ios/452/order-delivered.png" alt="Orders" />
    </button>
  </div>
  <div id="qr-content"></div>
  
  <style>
    #qr-content{
      display: none;  /* –°–∫—Ä—ã–≤–∞–µ–º —ç—Ç–∏ div –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
    }
  </style>
  
  
  <script>
    function showCurrentTime() {
      const now = new Date();
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      const seconds = String(now.getSeconds()).padStart(2, '0');
      const currentTime = `${hours}:${minutes}:${seconds}`;

      document.getElementById('clock').textContent = currentTime;
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
    setInterval(showCurrentTime, 1000);
    showCurrentTime();

    function showCurrentTime() {
  const now = new Date();
  
  const hours = String(now.getHours()).padStart(2, '0');
  const minutes = String(now.getMinutes()).padStart(2, '0');
  const seconds = String(now.getSeconds()).padStart(2, '0');
  
  const day = String(now.getDate()).padStart(2, '0');
  const month = String(now.getMonth() + 1).padStart(2, '0');
  const year = now.getFullYear();

  const currentTime = `${hours}:${minutes}:${seconds}`;
  const currentDate = `${day}.${month}.${year}`;

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∏ –¥–∞—Ç—ã
  document.getElementById('clock').textContent = ` ${currentTime} ${currentDate}`;
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∏ –¥–∞—Ç—ã
setInterval(showCurrentTime, 1000);
showCurrentTime();

  </script>

<script>
function changeContent(page) {
  const content = document.getElementById('content');
  const userInfo = document.querySelector('.user-info').outerHTML;

  switch (page) {
    case 'home':
      content.innerHTML = `
        ${userInfo}
        <h2>–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</h2>
        <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É!</p>
        <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª</h3>
        <div class="product-list" id="product-list"></div>
      `;
      renderProducts(mainSections, 'home');
      break;

    case 'terms':
      // ... (–≤–∞—à –∫–æ–¥ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è)
      break;

    case 'balance':
      renderBalance();
      break;

    case 'vendors':
      renderVendors();
      break;

    case 'virtual-numbers':
      content.innerHTML = `
        ${userInfo}
        <h2>–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –Ω–æ–º–µ—Ä–∞</h2>
        <div class="product-list" id="product-list"></div>
      `;
      renderProducts(virtualNumbers, 'virtual-numbers');
      break;

    case 'accounts':
      content.innerHTML = `
        ${userInfo}
        <h2>–ê–∫–∫–∞—É–Ω—Ç—ã</h2>
        <div class="product-list" id="product-list"></div>
      `;
      renderProducts(accounts, 'accounts');
      break;

    case 'subscriptions':
      content.innerHTML = `
        ${userInfo}
        <h2>–ü–æ–¥–ø–∏—Å–∫–∏</h2>
        <div class="product-list" id="product-list"></div>
      `;
      renderProducts(subscriptions, 'subscriptions');
      break;

    case 'global':
      content.innerHTML = `
        ${userInfo}
        <h2>Global</h2>

        <h3>–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –Ω–æ–º–µ—Ä–∞</h3>
        <div class="product-list" id="global-virtual-numbers"></div>

        <h3>–ê–∫–∫–∞—É–Ω—Ç—ã</h3>
        <div class="product-list" id="global-accounts"></div>

        <h3>–ü–æ–¥–ø–∏—Å–∫–∏</h3>
        <div class="product-list" id="global-subscriptions"></div>

        <div style="display:none;" id="product-list"></div> <!-- –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
      `;

      // –†–µ–Ω–¥–µ—Ä–∏–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –Ω–æ–º–µ—Ä–∞
      renderProducts(virtualNumbers, 'virtual-numbers');
      document.getElementById('global-virtual-numbers').innerHTML = document.getElementById('product-list').innerHTML;

      // –†–µ–Ω–¥–µ—Ä–∏–º –∞–∫–∫–∞—É–Ω—Ç—ã
      renderProducts(accounts, 'accounts');
      document.getElementById('global-accounts').innerHTML = document.getElementById('product-list').innerHTML;

      // –†–µ–Ω–¥–µ—Ä–∏–º –ø–æ–¥–ø–∏—Å–∫–∏
      renderProducts(subscriptions, 'subscriptions');
      document.getElementById('global-subscriptions').innerHTML = document.getElementById('product-list').innerHTML;
      break;

    case 'support':
      renderSupport();
      break;

    case 'cart':
      renderCart();
      break;

    case 'orders':
      renderOrders();
      break;

    default:
      content.innerHTML = `
        ${userInfo}
        <h2>–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</h2>
        <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É!</p>
        <h3>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª —Ç–æ–≤–∞—Ä–æ–≤</h3>
        <div class="product-list" id="product-list"></div>
      `;
      renderProducts(mainSections, 'home');
  }
}
</script>



  <script>
    const socket = new WebSocket('ws://localhost:3000'); // –õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä

    socket.onopen = function () {
      console.log('–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π');
    };

    socket.onmessage = function (event) {
      const notification = JSON.parse(event.data);
      showNotification(notification.message);
    };

    socket.onerror = function (error) {
      console.error('–û—à–∏–±–∫–∞ WebSocket: ', error);
    };

    function showNotification(message) {
      const notificationDiv = document.createElement('div');
      notificationDiv.className = 'notification';
      notificationDiv.textContent = message;

      document.body.appendChild(notificationDiv);

      setTimeout(() => {
        notificationDiv.remove();
      }, 5000);
    }

    async function fetchProducts() {
      const response = await fetch('http://localhost:3000/api/products');
      const data = await response.json();
      return data;
    }

    async function addToCart(product) {
      await fetch('http://localhost:3000/api/cart', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(product)
      });
    }
  </script>

  <script>
    window.addEventListener('load', function () {
  const tg = window.Telegram.WebApp;

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
  tg.expand(); // –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
  const user = tg.initDataUnsafe.user; // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

  if (user) {
    document.getElementById('username').textContent = user.username || `${user.first_name} ${user.last_name}`;
  } else {
    document.getElementById('username').textContent = '–ì–æ—Å—Ç—å';
  }

  changeContent('home');
});


if (user && user.photo_url) {
  document.getElementById('profile-picture').src = user.photo_url;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ URL
function getQueryParams() {
  const params = new URLSearchParams(window.location.search);
  const userId = params.get('user_id');
  const balance = params.get('balance');
  return { userId, balance };
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI —Å –±–∞–ª–∞–Ω—Å–æ–º
function updateBalance(balance) {
  const balanceElement = document.getElementById('balance');
  balanceElement.textContent = `–í–∞—à —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: üí∞ ${balance}‚ÇΩ`;
}

// –ö–æ–≥–¥–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –∏–∑–≤–ª–µ–∫–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –æ–±–Ω–æ–≤–ª—è–µ–º UI
document.addEventListener('DOMContentLoaded', () => {
  const { userId, balance } = getQueryParams();
  if (balance !== null) {
    updateBalance(balance);
  }
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ —á–µ—Ä–µ–∑ API
async function updateBalanceAPI(userId, newBalance) {
  const response = await fetch('http://127.0.0.1:8000/update_balance', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ user_id: userId, balance: newBalance }),  // –ü–µ—Ä–µ–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ JSON
  });

  if (!response.ok) {
    // –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ —É—Å–ø–µ—à–µ–Ω
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞');
    return;
  }

  const data = await response.json();
  return data;  // –û—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –Ω–æ–≤—ã–º –±–∞–ª–∞–Ω—Å–æ–º
}

</script>



</body>

</html>
