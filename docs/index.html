<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="telegram-web-app" content="true" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <title>Mini App</title>
  <link rel="stylesheet" href="style.css">
  <script src="script.jsx"></script>
</head>
<body>
  <header class="header">
    <button onclick="changeContent('settings')">⚙️</button>
    
    <div class="clock" id="clock"></div>
  </header>
  <div class="header" id="adm">Чтобы отменить заказ перезагрузитесь.</div>
  
  
  <div class="terms-link"> 
    <p>Пожалуйста, ознакомьтесь с нашим <a href="#" onclick="changeContent('terms')">пользовательским соглашением</a>.</p>
  </div>  

  <div id="content">
    <div class="user-info">
      <img id="profile-picture" src="images/profile.png" alt="Profile Picture" />
      <span id="username">Загрузка...</span>
      <span id="user-balance"></span> 
    </div>    
  </div>

  <div class="icon-buttons">
    <!-- Кнопка перехода на главную страницу -->
    <button onclick="goHome()">
      <img src="https://img.icons8.com/?size=100&id=s7mPVCB5sKGa&format=png&color=ffffff" alt="Home" />
    </button>

    <script>
      // Функция для перехода на главную страницу
      function goHome() {
        changeContent('home');  // Возвращаем пользователя на главную страницу
      }
    
      function renderBalance() {
      const content = document.getElementById('content');
      const userInfo = document.querySelector('.user-info').outerHTML;
      content.innerHTML = `
        ${userInfo}
        <h2>Баланс</h2>
        <p>Текущий баланс: ${balanceInfo.balance} ${balanceInfo.selectedCurrency}</p>
        <label for="currency">Выберите валюту:</label>
        <select id="currency" onchange="changeCurrency(event)">
          ${balanceInfo.currencies.map(currency => `<option value="${currency}" ${currency === balanceInfo.selectedCurrency ? 'selected' : ''}>${currency}</option>`).join('')}
        </select>
      `;
    }

    function changeCurrency(event) {
      balanceInfo.selectedCurrency = event.target.value;
      renderBalance();
    }

    function renderVendors() {
      const content = document.getElementById('content');
      const userInfo = document.querySelector('.user-info').outerHTML;
      content.innerHTML = `
        ${userInfo}
        <h2>Продавцы</h2>
        <div class="product-list" id="product-list"></div>
      `;
      renderProducts(vendors, 'vendors');
    }

      // Функция для изменения содержимого страницы
      function changeContent(page) {
        const content = document.getElementById('content');
        const userInfo = document.querySelector('.user-info').outerHTML;
    
        switch (page) {
          case 'home':
            content.innerHTML = `
              ${userInfo}
              <h2>Главная страница</h2>
              <p>Добро пожаловать на главную страницу!</p>
              <h3>Выберите раздел</h3>
              <div class="product-list" id="product-list"></div>
            `;
            renderProducts(mainSections, 'home');
            break;
            
            case 'subscriptions':
      content.innerHTML = `
        ${userInfo}
        <h2>Подписки</h2>
        <div class="product-list" id="product-list"></div>
      `;
      renderProducts(subscriptions, 'subscriptions');  // Добавление подписок
      break;
    
          case 'settings':
          content.innerHTML = `
        ${userInfo}
        <h2>Настройки</h2>
      `;
      renderProducts(settings, 'settings');
      break;

      case 'balance':
          renderBalance();
          break;

        case 'vendors':
          renderVendors();
          break;
    
          // Другие случаи
          default:
            content.innerHTML = `${userInfo} <h2>Главная страница</h2><p>Добро пожаловать на главную страницу!</p>`;
        }
      }
    
      window.addEventListener('load', function () {
        changeContent('home');
      });
    </script>
  
    <!-- Кнопка перехода в корзину -->
    <button onclick="changeContent('cart')">
      <img src="https://img.icons8.com/ios/452/shopping-cart.png" alt="Cart" />
    </button>
  
    <!-- Кнопка перехода к заказам -->
    <button onclick="changeContent('orders')">
      <img src="https://img.icons8.com/ios/452/order-delivered.png" alt="Orders" />
    </button>
  </div>
  <div id="qr-content"></div>
  
  <style>
    #qr-content{
      display: none;  /* Скрываем эти div по умолчанию */
    }
  </style>
  
  
  <script>
    function showCurrentTime() {
      const now = new Date();
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      const seconds = String(now.getSeconds()).padStart(2, '0');
      const currentTime = `${hours}:${minutes}:${seconds}`;

      document.getElementById('clock').textContent = currentTime;
    }

    // Обновление времени
    setInterval(showCurrentTime, 1000);
    showCurrentTime();

    function showCurrentTime() {
  const now = new Date();
  
  const hours = String(now.getHours()).padStart(2, '0');
  const minutes = String(now.getMinutes()).padStart(2, '0');
  const seconds = String(now.getSeconds()).padStart(2, '0');
  
  const day = String(now.getDate()).padStart(2, '0');
  const month = String(now.getMonth() + 1).padStart(2, '0');
  const year = now.getFullYear();

  const currentTime = `${hours}:${minutes}:${seconds}`;
  const currentDate = `${day}.${month}.${year}`;

  // Обновление времени и даты
  document.getElementById('clock').textContent = ` ${currentTime} ${currentDate}`;
}

// Обновление времени и даты
setInterval(showCurrentTime, 1000);
showCurrentTime();

  </script>

<script>
function changeContent(page) {
  const content = document.getElementById('content');
  const userInfo = document.querySelector('.user-info').outerHTML;

  switch (page) {
    case 'home':
      content.innerHTML = `
        ${userInfo}
        <h2>Главная страница</h2>
        <p>Добро пожаловать на главную страницу!</p>
        <h3>Выберите раздел</h3>
        <div class="product-list" id="product-list"></div>
      `;
      renderProducts(mainSections, 'home');
      break;

    case 'terms':
      // ... (ваш код соглашения)
      break;

    case 'balance':
      renderBalance();
      break;

    case 'vendors':
      renderVendors();
      break;

    case 'virtual-numbers':
      content.innerHTML = `
        ${userInfo}
        <h2>Виртуальные номера</h2>
        <div class="product-list" id="product-list"></div>
      `;
      renderProducts(virtualNumbers, 'virtual-numbers');
      break;

    case 'accounts':
      content.innerHTML = `
        ${userInfo}
        <h2>Аккаунты</h2>
        <div class="product-list" id="product-list"></div>
      `;
      renderProducts(accounts, 'accounts');
      break;

    case 'subscriptions':
      content.innerHTML = `
        ${userInfo}
        <h2>Подписки</h2>
        <div class="product-list" id="product-list"></div>
      `;
      renderProducts(subscriptions, 'subscriptions');
      break;

    case 'global':
      content.innerHTML = `
        ${userInfo}
        <h2>Global</h2>

        <h3>Виртуальные номера</h3>
        <div class="product-list" id="global-virtual-numbers"></div>

        <h3>Аккаунты</h3>
        <div class="product-list" id="global-accounts"></div>

        <h3>Подписки</h3>
        <div class="product-list" id="global-subscriptions"></div>

        <div style="display:none;" id="product-list"></div> <!-- временный контейнер -->
      `;

      // Рендерим виртуальные номера
      renderProducts(virtualNumbers, 'virtual-numbers');
      document.getElementById('global-virtual-numbers').innerHTML = document.getElementById('product-list').innerHTML;

      // Рендерим аккаунты
      renderProducts(accounts, 'accounts');
      document.getElementById('global-accounts').innerHTML = document.getElementById('product-list').innerHTML;

      // Рендерим подписки
      renderProducts(subscriptions, 'subscriptions');
      document.getElementById('global-subscriptions').innerHTML = document.getElementById('product-list').innerHTML;
      break;

    case 'support':
      renderSupport();
      break;

    case 'cart':
      renderCart();
      break;

    case 'orders':
      renderOrders();
      break;

    default:
      content.innerHTML = `
        ${userInfo}
        <h2>Главная страница</h2>
        <p>Добро пожаловать на главную страницу!</p>
        <h3>Выберите раздел товаров</h3>
        <div class="product-list" id="product-list"></div>
      `;
      renderProducts(mainSections, 'home');
  }
}
</script>



  <script>
    const socket = new WebSocket('ws://localhost:3000'); // Локальный сервер

    socket.onopen = function () {
      console.log('Подключено к серверу для получения уведомлений');
    };

    socket.onmessage = function (event) {
      const notification = JSON.parse(event.data);
      showNotification(notification.message);
    };

    socket.onerror = function (error) {
      console.error('Ошибка WebSocket: ', error);
    };

    function showNotification(message) {
      const notificationDiv = document.createElement('div');
      notificationDiv.className = 'notification';
      notificationDiv.textContent = message;

      document.body.appendChild(notificationDiv);

      setTimeout(() => {
        notificationDiv.remove();
      }, 5000);
    }

    async function fetchProducts() {
      const response = await fetch('http://localhost:3000/api/products');
      const data = await response.json();
      return data;
    }

    async function addToCart(product) {
      await fetch('http://localhost:3000/api/cart', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(product)
      });
    }
  </script>

  <script>
    window.addEventListener('load', function () {
  const tg = window.Telegram.WebApp;

  // Инициализация Telegram WebApp
  tg.expand(); // Разворачиваем приложение на весь экран
  const user = tg.initDataUnsafe.user; // Получаем данные пользователя

  if (user) {
    document.getElementById('username').textContent = user.username || `${user.first_name} ${user.last_name}`;
  } else {
    document.getElementById('username').textContent = 'Гость';
  }

  changeContent('home');
});


if (user && user.photo_url) {
  document.getElementById('profile-picture').src = user.photo_url;
}

// Функция для извлечения параметров из URL
function getQueryParams() {
  const params = new URLSearchParams(window.location.search);
  const userId = params.get('user_id');
  const balance = params.get('balance');
  return { userId, balance };
}

// Функция для обновления UI с балансом
function updateBalance(balance) {
  const balanceElement = document.getElementById('balance');
  balanceElement.textContent = `Ваш текущий баланс: 💰 ${balance}₽`;
}

// Когда веб-страница загружена, извлекаем параметры и обновляем UI
document.addEventListener('DOMContentLoaded', () => {
  const { userId, balance } = getQueryParams();
  if (balance !== null) {
    updateBalance(balance);
  }
});

// Функция для обновления баланса через API
async function updateBalanceAPI(userId, newBalance) {
  const response = await fetch('http://127.0.0.1:8000/update_balance', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ user_id: userId, balance: newBalance }),  // Передаем данные как JSON
  });

  if (!response.ok) {
    // Если запрос не успешен
    console.error('Ошибка при обновлении баланса');
    return;
  }

  const data = await response.json();
  return data;  // Ответ от сервера, например, с новым балансом
}

</script>



</body>

</html>
